// READ THESE!
  // FLICKR API OVERVIEW: https://www.flickr.com/services/api/misc.overview.html
  // FLICKR.PHOTOS.SEARCH OVERVIEW: https://www.flickr.com/services/api/flickr.photos.search.html
  // FLICKR JSON RESPONSE TYPE: https://www.flickr.com/services/api/response.json.html
  // HOW TO DISPLAY AN IMAGE USING FLICKR: https://www.flickr.com/services/api/misc.urls.html

var generateURL = function ( photo ) {
  // Access the important parts of this photo object that will be used to construct the src attribute of an img we will create soon - i.e. this is how we display an image
  var farmID = photo.farm;
  var server = photo.server;
  var id = photo.id;
  var secret = photo.secret;
  // https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{o-secret}_q.(jpg|gif|png)
  // Make the URL look right
  var url = "https://farm";
  url += farmID;
  url += ".staticflickr.com/";
  url += server;
  url += "/";
  url += id;
  url += "_";
  url += secret;
  url += "_q.jpg";

  // By this point, we should have a correct URL to display
    // Return it so that another function can use it later on
  return url;
};

var displayPhoto = function ( url ) {
  // Create a new img tag
  var $img = $("<img>");
  // Set the src attribute to be the valid URL that was passed to this function (the one that is generated by the generateURL function)
  $img.attr("src", url);
  // Put the img that we just created on the page at the end of the element with the ID of content
  $("#content").append( $img );
};

var handleFlickrResponse = function ( data ) {
  // Receives the data that was retrieved from the successful API call to Flickr
  // Access the information that we want
    // It's going to be an array of objects
  var photos = data.photos.photo;

  // Go through all of the photos
  for ( var i = 0; i < photos.length; i++ ) {
    // Store the current photo as currentPhoto
    var currentPhoto = photos[i];
    // We generate a URL that will eventually be used to display the image on the page as a src attribute
      // Read this: https://www.flickr.com/services/api/misc.urls.html
    var url = generateURL( currentPhoto );
    // After we have got the valid URL, call the displayPhoto function making sure to give it that URL
    displayPhoto( url );
  }
};

var searchFlickr = function ( searchTerm ) {
  // We create our base URL
    // ?nojsoncallback=1 - means give me back just the object, not the object wrapped in a function call
      // https://www.flickr.com/services/api/response.json.html
  var baseFlickrURL = "https://api.flickr.com/services/rest/?nojsoncallback=1";

  // Make a get request to the baseFlickrURL
    // Provide the information that this API cares about
  $.ajax({
    url: baseFlickrURL,
    type: "GET",
    data: {
      method: "flickr.photos.search", // What you want Flickr to do
      api_key: "2f5ac274ecfac5a455f38745704ad084", // The API key that will authenticate you
      text: searchTerm, // What you are searching for
      format: "json", // Who would ever want XML, we want JSON
      // page: 2 - if you want change the page, add this sort of thing
    }
  }).done( handleFlickrResponse );
};

// Wait until all elements are loaded
$(document).ready(function () {
  // Once they are, attach an event handler to the form
    // When the submit event is fired, run the following function
  $("form").on("submit", function ( event ) {
    // Store the information about the event in the event variable
      // By default, a form submission will refresh or redirect the page - we need to stop that
    event.preventDefault();
    // Get the current value of the input
    var searchTerm = $("form input").val();
    // Then we call searchFlickr passing in that value
    searchFlickr( searchTerm );
  });
});
